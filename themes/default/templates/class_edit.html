{% extends "base.html" %}

{% load staticfiles %}
{% load i18n %}
{% load pipeline %}
{% load is_course_coordinator %}

{% block js %}
    {{ block.super }}

    {% compressed_js 'core' %}
    {% compressed_js 'certificate' %}

    {{block.super}}
    <script>
        window.course_id = {{ class.course.pk }};
        window.class_id = {{ class.pk }};
    </script>
    {% compressed_js 'edit-class' %}

{% endblock %}

{% block wrapper_classes %}
wrapper-course-lesson
{% endblock %}

{% block content %}

<!-- class-modal -->
<div class="modal fade" id="class-modal" tabindex="-1" role="dialog" aria-labelledby="class-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content"></div>
    </div>
</div>

<div id="classes" class="course-classes" ng-app='edit_class' ng-controller="ClassController">
    <!-- ACTIONS -->
    <div class="actions-menu" fixed-bar>
        <div class="container">
            <div class="actions-buttons">
                <button class="btn btn-success" ng-click="save()">{% trans 'Save' %} | <i class="fa fa-save"></i></button>
            </div>

            {% include 'administration/_alert.html' %}

        </div>
    </div>
    <!-- END ACTIONS -->

    {% include "_course-header-inline.html"  with course=object.course %}
    <section id="classes-content" class="container">
    	<header class="secondary-header">
           <div class="row">
                <div class="col-lg-12">
                    <div class="editable-title"><input type="text" ng-model="classe.name" placeholder="{% trans 'Class name' %}"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-9">
                    <div class="professor-assistant">
                        <label for="{{ form.assistant.id_for_label }}">{% trans 'Assistant Professor' %}:</label>
                        {% if user|is_course_coordinator:object.course %}
                            <select class="form-control" ng-options="item.name for item in classe.course.professors track by item.id" ng-model="classe.assistant"></select>
                        {% else %}
                            <label>{{ object.assistant }}</label>
                        {% endif %}
                    </div>
                </div>
                <div class="col-xs-3">
                    <a class="btn btn-lg btn-danger uppercase"
                       href="{% url 'course-evaluations' object.course.slug %}#/class-evaluations/{{ object.id }}">
                        {% trans 'Certification' %}
                    </a>
                </div>
            </div>
        </header>

        <div class="alert row" role="alert"
             ng-class="{'alert-info': classe.user_can_certificate, 'alert-danger': !classe.user_can_certificate}">
            <div class="col-xs-8">
                {% trans 'Select if this class can emmit certificates.' %}
            </div>
            <div class="col-xs-4">
                <div class="professor-assistant user-can-certificate text-right">
                    <input
                            ng-model="classe.user_can_certificate"
                            ng-change="toggle_class_certificable()"
                            type="checkbox" />
                    <label>
                        {% trans 'Allows Certification' %}
                    </label>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <p><label>{% trans 'Add students to this class' %}</label></p>
                <div class="autocomplete">
                    <input type="text" id="search-user" class="form-control" ng-model="asyncSelected"
                                    placeholder="{% trans 'Type the name, email or user name of the professor to search...' %}"
                                    typeahead="user as user.formated_name for user in getUsers($viewValue)"
                                    typeahead-loading="loadingLocations"
                                    typeahead-on-select="on_select_student($model); asyncSelected = '';"
                                    typeahead-min-length="2"
                                    typeahead-wait-ms="500">
                    <i ng-show="loadingLocations" class="loading fa fa-refresh fa-spin"></i>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <table class="table table-list">
                    <tr>
                        <th class="classname">{% trans "Username" %}</th>
                        <th class="email">{% trans "Email" %}</th>
                        <th class="fullname">{% trans "Full name" %}</th>
==== BASE ====
                        <th class="progress" ng-show="classe.user_can_certificate">{% trans "Certificate" %}</th>
==== BASE ====
                        {% if object.course.default_class != object %}
                        <th class="actions">{% trans "Actions" %}</th>
                        {% endif %}
                    </tr>

                    {% verbatim %}
                    <tr ng-repeat='student in classe.students'>
==== BASE ====
                        {% verbatim %}
                        <td>{{ student.user.username }}</td>
                        <td>{{ student.user.email }}</td>
                        <td>{{ student.user.name }}</td>
                        <td ng-show="classe.user_can_certificate"><input type='checkbox' ng-disabled='!student.can_emmit_receipt'></td>
                        {% endverbatim %}
                        {% if object.course.default_class != object %}
                            <td class="actions">
                                <a ng-click="remove_item($index)" class="btn btn-warning"><i class="fa fa-trash-o"></i></a>
                            </td>
                        {% endif %}
==== BASE ====
                    </tr>
                    {% endverbatim %}

                    <tr ng-hide="classe.students.length > 0">
                        <td colspan="4">{% trans 'No students found' %}</td>
                    </tr>

                </table>
            </div>
        </div>
    </section>
</div>
{% endblock %}
